# Migration `20201207073103`

This migration has been generated by mingyuchooo at 12/7/2020, 4:31:03 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('USER', 'ADMIN')

CREATE TABLE "User" (
"id" SERIAL,
    "email" TEXT NOT NULL,
    "firstName" TEXT NOT NULL,
    "lastName" TEXT NOT NULL,
    "role" "Role" NOT NULL DEFAULT E'USER',

    PRIMARY KEY ("id")
)

CREATE TABLE "Profile" (
"id" SERIAL,
    "bio" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Post" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "title" TEXT NOT NULL,
    "content" TEXT,
    "published" BOOLEAN NOT NULL DEFAULT false,
    "authorId" INTEGER,
    "keywords" TEXT[],

    PRIMARY KEY ("id")
)

CREATE TABLE "Category" (
"id" SERIAL,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
"id" SERIAL,
    "title" TEXT NOT NULL,
    "content" TEXT,
    "postId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
    "name" TEXT NOT NULL,

    PRIMARY KEY ("name")
)

CREATE TABLE "_CategoryToPost" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE TABLE "_PostToTag" (
    "A" INTEGER NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE INDEX "User.firstName_lastName_index" ON "User"("firstName", "lastName")

CREATE UNIQUE INDEX "Profile_userId_unique" ON "Profile"("userId")

CREATE INDEX "Post.authorId_title_index" ON "Post"("authorId", "title")

CREATE UNIQUE INDEX "_CategoryToPost_AB_unique" ON "_CategoryToPost"("A", "B")

CREATE INDEX "_CategoryToPost_B_index" ON "_CategoryToPost"("B")

CREATE UNIQUE INDEX "_PostToTag_AB_unique" ON "_PostToTag"("A", "B")

CREATE INDEX "_PostToTag_B_index" ON "_PostToTag"("B")

ALTER TABLE "Profile" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Post" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("postId")REFERENCES "Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "_CategoryToPost" ADD FOREIGN KEY("A")REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_CategoryToPost" ADD FOREIGN KEY("B")REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_PostToTag" ADD FOREIGN KEY("A")REFERENCES "Post"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_PostToTag" ADD FOREIGN KEY("B")REFERENCES "Tag"("name") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201207073103
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,66 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Role {
+  USER
+  ADMIN
+}
+
+model User {
+  id        Int       @id @default(autoincrement())
+  email     String    @unique
+  firstName String
+  lastName  String
+  role      Role      @default(USER)
+  profile   Profile?
+  posts     Post[]
+  @@index([firstName, lastName])
+}
+
+model Profile {
+  id     Int      @id @default(autoincrement())
+  bio    String
+  userId Int
+  user   User     @relation(fields: [userId], references: [id])
+}
+
+model Post {
+  id          Int         @id @default(autoincrement())
+  createdAt   DateTime    @default(now())
+  title       String
+  content     String?
+  published   Boolean     @default(false)
+  authorId    Int?
+  author      User?       @relation(fields: [authorId], references: [id] )
+  categories  Category[]
+  comments    Comment[]  
+  keywords    String[] 
+  tags        Tag[]
+  @@index([authorId, title])
+}
+
+model Category {
+  id    Int     @id @default(autoincrement())
+  name  String
+  posts Post[]
+}
+
+model Comment {
+  id      Int     @id @default(autoincrement())
+  title   String
+  content String?
+  postId  Int?
+  post    Post?   @relation(fields: [postId], references: [id])
+}
+
+
+model Tag {
+  name    String  @id
+  posts   Post[]
+}
```


