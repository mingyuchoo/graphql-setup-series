# Migration `20201012193848`

This migration has been generated by mingyuchoo at 10/13/2020, 4:38:48 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `books` DROP FOREIGN KEY `FKfjixh2vym2cvfj3ufxj91jem7`

ALTER TABLE `books` DROP FOREIGN KEY `FK85qvvbrxtcq2p2itycbx76q1p`

CREATE TABLE `users` (
`id` int  NOT NULL  AUTO_INCREMENT,
`username` varchar(191)  NOT NULL ,
`email` varchar(191)  NOT NULL ,
`firstName` varchar(191)  ,
`lastName` varchar(191)  ,
`isAdmin` boolean  NOT NULL DEFAULT false,
`role` ENUM('ADMIN', 'USER', 'CUSTOMER')  NOT NULL DEFAULT 'USER',
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`postCount` int  NOT NULL DEFAULT 0,
UNIQUE INDEX `users.username_unique`(`username`),
UNIQUE INDEX `users.email_unique`(`email`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `profiles` (
`id` int  NOT NULL  AUTO_INCREMENT,
`bio` varchar(191)  NOT NULL ,
`userId` int  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
UNIQUE INDEX `profiles_userId_unique`(`userId`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `posts` (
`id` int  NOT NULL  AUTO_INCREMENT,
`title` varchar(191)  NOT NULL ,
`content` varchar(191)  ,
`published` boolean  NOT NULL DEFAULT false,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`authorId` int  ,
UNIQUE INDEX `posts.authorId_title_unique`(`authorId`,
`title`),
INDEX `posts.title_content_index`(`title`,
`content`),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `categories` (
`id` int  NOT NULL  AUTO_INCREMENT,
`name` varchar(191)  NOT NULL ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `comments` (
`id` int  NOT NULL  AUTO_INCREMENT,
`title` varchar(191)  NOT NULL ,
`content` varchar(191)  NOT NULL ,
`postId` int  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `tags` (
`name` varchar(191)  NOT NULL ,
`postId` int  ,
`createdAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
`updatedAt` datetime(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP(3),
PRIMARY KEY (`name`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `_CategoryToPost` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_CategoryToPost_AB_unique`(`A`,
`B`),
INDEX `_CategoryToPost_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `profiles` ADD FOREIGN KEY (`userId`) REFERENCES `root`.`users`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `posts` ADD FOREIGN KEY (`authorId`) REFERENCES `root`.`users`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `comments` ADD FOREIGN KEY (`postId`) REFERENCES `root`.`posts`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `tags` ADD FOREIGN KEY (`postId`) REFERENCES `root`.`posts`(`id`) ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE `_CategoryToPost` ADD FOREIGN KEY (`A`) REFERENCES `root`.`categories`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_CategoryToPost` ADD FOREIGN KEY (`B`) REFERENCES `root`.`posts`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

DROP TABLE `authors`

DROP TABLE `books`

DROP TABLE `book_stores`

DROP TABLE `cities`
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200928201212..20201012193848
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -22,10 +22,12 @@
   isAdmin   Boolean  @default(false)
   role      Role     @default(USER)
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
+  postCount Int      @default(0)
   posts     Post[]
   profile   Profile?
+
   @@map("users")
 }
 model Profile {
@@ -34,8 +36,9 @@
   user      User     @relation(fields: [userId], references: [id])
   userId    Int
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
+
   @@map("profiles")
 }
 model Post {
@@ -49,8 +52,9 @@
   authorId   Int?
   categories Category[] @relation(references: [id])
   comments   Comment[]
   tags       Tag[]
+
   @@unique([authorId, title])
   @@index([title, content])
   @@map("posts")
 }
@@ -60,8 +64,9 @@
   name      String
   posts     Post[]   @relation(references: [id])
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
+
   @@map("categories")
 }
 model Comment {
@@ -71,8 +76,9 @@
   Post      Post?    @relation(fields: [postId], references: [id])
   postId    Int?
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
+
   @@map("comments")
 }
 model Tag {
@@ -80,6 +86,7 @@
   Post      Post?    @relation(fields: [postId], references: [id])
   postId    Int?
   createdAt DateTime @default(now())
   updatedAt DateTime @default(now())
+
   @@map("tags")
 }
```


